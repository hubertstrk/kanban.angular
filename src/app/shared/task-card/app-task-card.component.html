<div class="flex bg-white dark:bg-zinc-600 rounded-lg mb-2 shadow-sm"
     (dblclick)="onOpenViewModal()">
  <div [ngClass]="getPriorityClass()"></div>
  <div class="p-3 flex flex-col w-full">
    <div class="flex justify-between">
      <div class="flex flex-col">
        <div [ngClass]="getTitleClass()">{{ task.title }}</div>
        <div
          *ngIf="task.dueAt"
          [ngClass]="getDueClass()">
          <span *ngIf="isOverdue()">{{ task.dueAt | dueDate }} overdue</span>
          <span *ngIf="!isOverdue()">{{ task.dueAt | dueDate }} left</span>
        </div>
      </div>
      <div class="flex">
        <app-button
          (clicked)="onOpenEditModal()"
          [size]="'sm'"
          [icon]="icons['fluent--note-24-regular']">
        </app-button>
        <app-button
          *ngIf="task.status === 'done'"
          (clicked)="onDeleteTask()"
          [size]="'sm'"
          [icon]="icons['fluent--delete-24-regular']">
        </app-button>
      </div>
    </div>

    <div class="text-sm text-zinc-600 dark:text-zinc-300">{{ getTaskContent(task.content) }}
    </div>
  </div>
</div>

<!-- view -->
<app-modal [isOpen]="isViewModalOpen" (closed)="closeModal()">
  <div modalTitle class="flex flex-col gap-2">
    <div class="text-lg">{{ task.title }}</div>
    <div
      *ngIf="task.dueAt"
      [ngClass]="getDueClass()">
      <span *ngIf="isOverdue()">{{ task.dueAt | dueDate }} overdue</span>
      <span *ngIf="!isOverdue()">{{ task.dueAt | dueDate }} left</span>
    </div>
  </div>

  <div class="flex flex-col">
    <div class="prose dark:prose-invert max-w-none" [innerHTML]="getRenderedContent()"></div>
  </div>
</app-modal>

<!-- edit -->
<app-modal [isOpen]="isEditModalOpen" (closed)="closeModal()">
  <div modalTitle>Edit Task</div>

  <div class="flex flex-col gap-4">
    <div class="flex flex-col gap-2">
      <label class="text-sm font-medium">Title</label>
      <input
        type="text"
        [(ngModel)]="editedTask.title"
        class="border border-gray-300 dark:border-gray-600 rounded-md p-2 dark:bg-zinc-700"
      >
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm">Priority</label>
      <app-dropdown
        id="taskPriority"
        [options]="priorityOptions"
        [selectedValue]="editedTask.priority ?? TaskPriority.Medium"
        (selectionChange)="onPriorityChange($event)"
      ></app-dropdown>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm">Due Date</label>
      <app-date-picker
        id="taskDueDate"
        [date]="editedTask.dueAt ?? null"
        (dateChange)="onDueDateChange($event)"
      ></app-date-picker>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm">Description</label>
      <app-monaco-editor
        [content]="editedTask.content || ''"
        (contentChange)="editedTask.content = $event"
      ></app-monaco-editor>
    </div>
  </div>

  <div modalFooter class="flex gap-2">
    <app-button (clicked)="closeModal()" [rounded]="false">
      <span class="px-2">Cancel</span>
    </app-button>
    <app-button (clicked)="saveTask()" [variant]="'secondary'" [rounded]="false">
      <span class="px-2">Save</span>
    </app-button>
  </div>
</app-modal>
